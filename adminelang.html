<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="photo/logo11.png" />
    <!-- icons -->
    <script
      src="https://kit.fontawesome.com/62a2566edd.js"
      crossorigin="anonymous"
    ></script>
    <!-- My CSS -->
    <link rel="stylesheet" href="admine.css" />

    <title>Dashboard</title>
  </head>

  <style>
    #languageName,
    #languageImage {
      width: 200px;
      padding: 8px;
      margin-left: 2%;
      border: 1px solid #000000;
      border-radius: 5px;
      box-sizing: border-box;
      /* Ensure padding is included in the width */
    }

    button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      background-color: #1e1b6d;
      color: #ffffff;
      cursor: pointer;
    }

    button:hover {
      background-color: #407bff;
    }

    /* Add your CSS styles for the modal here */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background-color: #ffffff;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888888;
      width: 30%;
    }

    .close {
      color: #ff0707;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    /* Styles for form fields */
    label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
      color: #493eeb;
    }

    input[type="text"],
    input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    input[type="submit"],
    button[type="submit"] {
      background-color: #493eeb;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    input[type="submit"]:hover,
    button[type="submit"]:hover {
      background-color: #0056b3;
    }

    /* Additional styles for the form fields can be added here */
  </style>

  <body>
    <!-- SIDEBAR -->
    <section id="sidebar">
      <a href="#" class="brand">
        <img
          src="photo/logo11.png"
          alt=""
          style="margin-left: 5%; margin-top: 5%"
        />
        <span class="text" style="margin-left: 3%; margin-top: 5%"
          >DashBoard</span
        >
      </a>
      <ul class="side-menu top">
        <li class="active">
          <a href="adminehome.html">
            <i class="fas fa-home"></i>
            <span class="text">Home</span>
          </a>
        </li>
        <li class="active">
          <a href="admineatte.html">
            <i class="fas fa-user"></i>
            <span class="text">Student</span>
          </a>
        </li>
        <li class="active">
          <a
            href="adminelang.html"
            style="color: #407bff; background-color: #1e1b6d"
          >
            <i class="fas fa-solid fa-graduation-cap"></i>
            <span class="text">Programs</span>
          </a>
        </li>
        <li class="active">
          <a href="adminesetti.html">
            <i class="fas fa-light fa-sliders"></i>
            <span class="text">Settings</span>
          </a>
        </li>
      </ul>
      <ul class="side-menu">
        <li>
          <a href="#" class="logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content">
      <!-- NAVBAR -->
      <nav>
        <i class="bx bx-menu"></i>
        <form action="#">
          <div class="form-input">
            <input type="text" id="search-input" placeholder="Search..." />
            <button
              type="submit"
              class="search-btn"
              onclick="searchWithinPage()"
            >
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
          <div id="searchResults"></div>
        </form>
        <a href="#" class="profile">
          <img src="img/people.png" />
        </a>
      </nav>
      <!-- NAVBAR -->

      <!-- MAIN -->
      <main>
        <section class="attendance">
          <div id="Programs" style="height: fit-content; padding: 2em">
            <section id="languages" class="program-section">
              <div
                class="header"
                style="display: flex; justify-content: space-between"
              >
                <h2>Languages</h2>
                <button
                  id="openLanguageModalBtn"
                  class="open-modal"
                  data-section="languages"
                >
                  Add Language
                </button>
              </div>
              <div class="table-container">
                <table class="table" id="languages-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Number of courses</th>
                      <th>Delete</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Rows will be added here dynamically -->
                  </tbody>
                </table>
              </div>
            </section>

            <section id="Activity" class="program-section">
              <div
                class="header"
                style="display: flex; justify-content: space-between"
              >
                <h2>Activities</h2>
                <button
                  id="openActivityModalBtn"
                  class="open-modal"
                  data-section="activities"
                >
                  Add Activity
                </button>
              </div>
              <div class="table-container">
                <table class="table" id="activities-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Description</th>
                      <th>Location</th>
                      <th>Delete</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Rows will be added here dynamically -->
                  </tbody>
                </table>
              </div>
            </section>
            <section id="Courses" class="program-section">
              <div
                class="header"
                style="display: flex; justify-content: space-between"
              >
                <h2>Courses</h2>
                <button
                  id="openCourseModalBtn"
                  class="open-modal"
                  data-section="courses"
                >
                  Add Course
                </button>
              </div>
              <div class="table-container">
                <table class="table" id="courses-table">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Price</th>
                      <th>Students Enrolled</th>
                      <!-- students/max-->
                      <th>Level</th>
                      <th>Language</th>
                      <th>More</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Rows will be added here dynamically -->
                  </tbody>
                </table>
              </div>
            </section>
            <div id="myModal" class="modal">
              <div class="modal-content">
                <span class="close">&times;</span>
                <!-- Modal content -->
                <form id="languageForm">
                  <!-- Your form fields go here -->
                  <label for="languageName">Language img :</label>
                  <input
                    type="file"
                    id="languageImage"
                    name="languageImage"
                    required
                  />
                  <label for="languageName">Language Name:</label>
                  <input
                    type="text"
                    id="languageName"
                    name="languageName"
                    required
                  />
                  <br /><br />
                  <button type="submit">Submit</button>
                </form>
              </div>
              <script>
                let token = localStorage.getItem("token"); // Get the token from local storage
                document
                  .getElementById("languageForm")
                  .addEventListener("submit", function (event) {
                    event.preventDefault(); // Prevent the form from being submitted normally

                    // Get the form fields
                    const languageImageFile =
                      document.getElementById("languageImage").files[0];
                    const languageName =
                      document.getElementById("languageName").value;

                    const languageImage = languageImageFile
                      ? languageImageFile.name
                      : "";

                    // Create a new JSON object
                    const languageData = {
                      name: languageName,
                      photo: languageImage,
                    };

                    console.log(languageData);

                    // Send the JSON data to the server
                    fetch("http://localhost:3000/languages", {
                      method: "POST",
                      headers: {
                        Authorization: "Bearer " + token, // Add the authorization header
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify(languageData),
                    })
                      .then((response) => response.json())
                      .then((data) => {
                        console.log("Success:", data);
                        showLanguages(); // Refresh the languages table
                      })
                      .catch((error) => {
                        console.error("Error:", error);
                      });
                  });
              </script>
            </div>
            <!-- Add this modal structure after the language modal -->
            <div id="activityModal" class="modal">
              <div class="modal-content">
                <span class="close" id="activityClose">&times;</span>
                <!-- Modal content -->
                <form id="activityForm">
                  <label for="activityTitle">Activity Title:</label>
                  <input
                    type="text"
                    id="activityTitle"
                    name="activityTitle"
                    required
                  />
                  <label for="activityDescription">Activity Description:</label>
                  <input
                    type="text"
                    id="activityDescription"
                    name="activityDescription"
                    required
                  />
                  <label for="activityLocation">Activity Location:</label>
                  <input
                    type="text"
                    id="activityLocation"
                    name="activityLocation"
                  />
                  <label for="activityPhoto">Activity Photo:</label>
                  <input
                    type="file"
                    id="activityPhoto"
                    name="activityPhoto"
                    required
                  />
                  <label for="activityTiming">Activity Timing:</label>
                  <input
                    type="datetime-local"
                    id="activityTiming"
                    name="activityTiming"
                  />
                  <br /><br />
                  <button type="submit">Submit</button>
                </form>
              </div>
              <script>
                document
                  .getElementById("activityForm")
                  .addEventListener("submit", function (event) {
                    event.preventDefault(); // Prevent the form from being submitted normally

                    // Get the form fields
                    const activityTitle =
                      document.getElementById("activityTitle").value;
                    const activityDescription = document.getElementById(
                      "activityDescription"
                    ).value;
                    const activityLocation =
                      document.getElementById("activityLocation").value;
                    const activityPhoto =
                      document.getElementById("activityPhoto").value;
                    const activityTiming =
                      document.getElementById("activityTiming").value;

                    // Create a new JSON object
                    const activityData = {
                      title: activityTitle,
                      descreption: activityDescription,
                      location: activityLocation,
                      photo: activityPhoto,
                      timing: new Date(activityTiming),
                    };

                    // Send the JSON data to the server
                    fetch("http://localhost:3000/Activity", {
                      method: "POST",
                      headers: {
                        Authorization: "Bearer " + token, // Add the authorization header
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify(activityData),
                    })
                      .then((response) => response.json())
                      .then((data) => {
                        console.log("Success:", data);
                        showActivity(); // Refresh the activities table
                      })
                      .catch((error) => {
                        console.error("Error:", error);
                      });
                  });
              </script>
            </div>
          </div>
        </section>
      </main>
      <script>
        function searchWithinPage() {
          var input = document
            .getElementById("search-input")
            .value.toUpperCase();
          var table = document.querySelector(".table");
          var rows = table.getElementsByTagName("tr");

          for (var i = 0; i < rows.length; i++) {
            var nameCell = rows[i].getElementsByTagName("td")[0]; // Assuming the name is in the first column (index 0)
            if (nameCell) {
              var nameText = nameCell.textContent || nameCell.innerText;
              if (nameText.toUpperCase().indexOf(input) > -1) {
                rows[i].style.display = "";
              } else {
                rows[i].style.display = "none";
              }
            }
          }
        }
        // Get the button that opens the modal
        var openModalBtn = document.querySelector(".open-modal");

        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var closeBtn = modal.querySelector(".close");

        // When the user clicks on the button, open the modal
        openModalBtn.addEventListener("click", function () {
          modal.style.display = "block";
        });

        // When the user clicks on <span> (x), close the modal
        closeBtn.addEventListener("click", function () {
          modal.style.display = "none";
        });

        // When the user clicks anywhere outside of the modal, close it
        window.addEventListener("click", function (event) {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
        // Get the button that opens the activity modal
        var openActivityModalBtn = document.querySelector(
          '.open-modal[data-section="activities"]'
        );

        // Get the activity modal
        var activityModal = document.getElementById("activityModal");

        // Get the <span> element that closes the activity modal
        var activityCloseBtn = activityModal.querySelector(".close");

        // When the user clicks on the button, open the activity modal
        openActivityModalBtn.addEventListener("click", function () {
          activityModal.style.display = "block";
        });

        // When the user clicks on <span> (x), close the activity modal
        activityCloseBtn.addEventListener("click", function () {
          activityModal.style.display = "none";
        });

        // When the user clicks anywhere outside of the activity modal, close it
        window.addEventListener("click", function (event) {
          if (event.target === activityModal) {
            activityModal.style.display = "none";
          }
        });

        function showLanguages() {
          fetch("http://localhost:3000/languages")
            .then((response) => response.json())
            .then((data) => {
              console.log("languages");
              console.log(data);
              const languagesTable = document.getElementById("languages-table");
              const tbody = languagesTable.querySelector("tbody");
              tbody.innerHTML = ""; // Clear the table

              // Add each language to the table
              data.data.languages.forEach((language) => {
                const row = document.createElement("tr");
                const nameCell = document.createElement("td");
                const nbCoursesCell = document.createElement("td");
                nameCell.textContent = language.name;
                if (language.courses) {
                  nbCoursesCell.textContent = language.courses.length;
                } else {
                  nbCoursesCell.textContent = 0;
                }
                const deleteCell = document.createElement("td");
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.style.backgroundColor = "red";
                deleteCell.appendChild(deleteButton);
                row.appendChild(nameCell);
                row.appendChild(nbCoursesCell);
                row.appendChild(deleteCell);
                tbody.appendChild(row);
              });
            })
            .catch((error) => console.error("Error:", error));
        }

        function showActivity() {
          fetch("http://localhost:3000/Activity")
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              const activitiesTable =
                document.getElementById("activities-table");
              const tbody = activitiesTable.querySelector("tbody");
              tbody.innerHTML = ""; // Clear the table

              // Add each activity to the table
              data.data.theActivities.forEach((activity) => {
                const row = document.createElement("tr");
                const nameCell = document.createElement("td");
                const descriptionCell = document.createElement("td");
                const locationCell = document.createElement("td");
                nameCell.textContent = activity.title;
                descriptionCell.textContent = activity.descreption;
                locationCell.textContent = activity.location;
                const deleteCell = document.createElement("td");
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.style.backgroundColor = "red";
                deleteCell.appendChild(deleteButton);
                row.appendChild(nameCell);
                row.appendChild(descriptionCell);
                row.appendChild(locationCell);
                row.appendChild(deleteCell);
                tbody.appendChild(row);
              });
            })
            .catch((error) => console.error("Error:", error));
        }

        function getMe() {
          fetch("http://localhost:3000/me", {
            headers: {
              Authorization: "Bearer " + token,
            },
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("I am");
              console.log(data);
            })
            .catch((error) => {
              console.log(error);
            });
        }
        function getCourses() {
          fetch("http://localhost:3000/courses", {
            headers: {
              Authorization: "Bearer " + token,
            },
          })
            .then((response) => response.json())
            .then((data) => {
              const tableBody = document
                .getElementById("courses-table")
                .getElementsByTagName("tbody")[0];

              // Clear the table body
              tableBody.innerHTML = "";
              console.log("Courses");
              console.log(data.data.data);
              // Add a new row for each course
              data.data.data.forEach((course) => {
                const newRow = tableBody.insertRow();

                const titleCell = newRow.insertCell();
                const priceCell = newRow.insertCell();
                const studentsEnrolledCell = newRow.insertCell();
                const levelCell = newRow.insertCell();
                const languageCell = newRow.insertCell();
                const moreCell = newRow.insertCell();

                titleCell.textContent = course.title;
                priceCell.textContent = course.price;
                studentsEnrolledCell.textContent = course.studentsEnrolled;
                levelCell.textContent = course.level;
                fetch(`http://localhost:3000/languages/${course.language}`)
                  .then((response) => response.json())
                  .then(
                    (data) =>
                      (languageCell.textContent = data.data.language.name)
                  );
                moreCell.innerHTML = '<a href="#">More</a>';
              });
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        }

        getCourses();
        getMe();
        showActivity();
        showLanguages();
      </script>
    </section>
  </body>
</html>
